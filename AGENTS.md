本文件是面向 AI 编程代理的项目规则与操作手册。请严格遵循本页的约束与流程。
注：在多包/多模块仓库中，若子目录也存在 AGENTS.md，就近原则优先使用距离目标文件最近的那份。

1) 项目概览与边界

项目简介：
zero-human-code 是一个示例仓库，用于演示如何通过 AI 编程代理协作完成软件开发任务。当前仓库仅包含文档，可作为后续实验的起点。

目标：修复 bug、小功能迭代、编写或更新测试、维护文档、提供代码审查建议。

不做：代理必须不要尝试执行以下操作：
- 修改生产基础设施、删除数据、强推破坏性的依赖升级。
- 写入密钥、提交包含凭据的文件、擅自发布到生产。

关键目录：
- /src：源代码目录（若存在）。
- /tests：单元测试目录。

2) 快速开始与环境

语言与运行时：Python 3.11。
包管理与工具链：pip、ruff、pytest。
本地依赖安装：

```
pip install -r requirements.txt  # 若存在需求文件
```

启动开发服务：

```
python src/main.py  # 如项目包含可运行入口
```

重要脚本：

```
ruff format .      # 格式化
ruff check .       # Lint
pytest             # 运行测试
```

3) 构建、检查与测试

统一测试入口：
```
pytest
```

选择性运行：
```
pytest tests/test_example.py::test_case
```

质量闸（必须通过）：
```
ruff check .    # 代码规范
# 暂无类型检查要求
```

CI 位置：.github/workflows/ci.yml（尚未配置）。本地执行需与 CI 同步通过。

代理应在提交前自动运行上述检查并修复失败项；新增/变更代码应补充或更新相应测试。

4) 代码风格与规范

语言级别：Python 3.11，鼓励使用类型注解。
格式化：使用 `ruff format`，无特殊忽略策略。
命名与结构：
- 模块/包命名：使用小写，下划线或短横线分隔。
- 文件组织：源代码置于 `src/`，测试置于 `tests/`，文档置于根目录或 `docs/`。

提交信息：遵循 Conventional Commits，示例：`feat: support dark mode`。

兼容性与弃用：
- 新代码不得引入未经评估的外部服务调用。
- 若移除/替换接口，需附带迁移说明。

5) 常见任务 Playbooks
5.1 修复单元测试失败
- 运行测试。
- 最小改动修复失败点，必要时补测试覆盖。
- 运行全量检查，确保通过。
- 更新变更记录并提交。

5.2 新增小特性
- 在 `src/` 中按约定创建/修改文件。
- 补充/更新测试与文档。
- 本地通过构建、lint、测试。
- 发起变更，遵循 PR 模板。

5.3 依赖升级（安全/补丁级）
- 仅升级必要范围，变更最小化。
- 运行全量测试与构建。
- 如有破坏性变更，回滚并开 Issue 说明。

6) 工具与接口（Tools/MCP/函数工具）

代理可调用的工具必须声明清楚输入/输出与副作用。

名称    类型    入口    输入模式        输出模式        副作用/注意
(暂无定义的自定义工具)

调用约束：
- 不得写入除仓库目录之外的路径。
- 网络访问仅允许访问公开的包管理与文档站点。
- 遇到 4xx/5xx 重试最多 2 次并记录日志。

7) 权限、密钥与环境变量
- 读取方式：系统环境变量或 `.env`（若存在）。
- 必需变量：无。
- 安全要求：禁止将密钥写入仓库、日志与 PR；必要时用占位符模拟。

8) 数据与隐私
- 输入数据可能包含敏感信息。
- 不得将样本数据上传到外部服务；如需脱敏，请手动处理。
- 日志中对个人标识字段进行掩码。

9) 安全护栏
- 禁止执行具有破坏性或不可逆操作的命令，如 `rm -rf /`。
- 任何外部发包/部署动作必须由人类触发。

10) 模型与推理偏好
- 推荐模型：gpt-4o，temperature 0。
- 结构化输出：优先使用 JSON，失败时回退为纯文本并重试一次。
- 上下文策略：优先读取与当前改动文件最近的 AGENTS.md。

11) 多代理协作与交接
- 可由 triage-agent 将任务分配给 bugfix-agent 或 feature-agent。
- 交接时携带上下文：问题描述、相关文件清单、失败用例、已尝试步骤。
- 禁止循环交接；最多 2 次后回退人工处理。

12) 评估与回归
- 基线任务清单：修复测试、编写文档、添加小功能。
- 通过标准：所有修改通过测试且无 lint 违例。
- 评估脚本：暂无。

13) 观测与追踪
- 本地调试日志：在运行脚本时加上 `--verbose`。
- 产物：将运行记录输出到 `.artifacts/`（若目录存在），包含命令、错误、摘要。

14) 失败恢复与回滚
- 若测试红、lint 不通过或依赖破坏性变更，必须回滚。
- 回滚流程：`git revert`，并创建 Issue 追踪。
- 提供最小复现步骤与修复建议。

15) 提交与 PR 规则
- 提交信息：遵循 Conventional Commits。
- PR 模板要点：变更类型与范围、对应 Issue、测试清单、风险与回滚预案。
- 合并策略：Squash；保护分支：main。

16) Monorepo 说明
- 当前仓库非 monorepo，无额外说明。

17) 术语表与联系人
- 术语：无。
- 负责人：暂无。
- 紧急通道：在 Issue 中 @maintainer。

附：最小命令速查
# 安装
pip install -r requirements.txt

# 开发
python src/main.py  # 如存在

# 全量检查
ruff check . && pytest

# 单测聚焦
pytest tests/test_example.py::test_case

维护说明：本文件为活文档。当规约或脚本更新时，请同步修改此处。
