AGENTS.md

本文件是面向 AI 编程代理的项目规则与操作手册。请严格遵循本页的约束与流程。
注：在多包/多模块仓库中，若子目录也存在 AGENTS.md，就近原则优先使用距离目标文件最近的那份。

1) 项目概览与边界

项目简介：

目标：<列出代理可以协助的任务类型：修 bug / 写测试 / 重构 / 小功能迭代 / 文档维护 / 代码审查建议>

不做：代理必须不要尝试执行以下操作：

修改生产基础设施、删除数据、强推有破坏性的依赖升级

写入密钥、提交包含凭据的文件、擅自发布到生产

关键目录：

/<path>：<说明用途与约定>

/<path>：<说明用途与约定>

2) 快速开始与环境

语言与运行时：<Node 20 / Python 3.11 / Java 21 / …>

包管理与工具链：<pnpm / uv / poetry / gradle / …>

本地依赖安装：

<安装命令，例如：pnpm install 或 uv sync>


启动开发服务：

<启动命令，例如：pnpm dev / uv run app.py>


重要脚本：

<列出脚本别名，例如：pnpm build / pnpm typecheck / pnpm format>

3) 构建、检查与测试

统一测试入口：

<例如：pnpm test  或  pytest -q  或  gradle test>


选择性运行：

<按路径/标签/模式运行测试的示例命令>


质量闸（必须通过）：

<lint 命令>    # 例如：pnpm lint / ruff check .
<type 命令>    # 例如：pnpm typecheck / mypy .


CI 位置：<.github/workflows/...>。本地执行需与 CI 同步通过。

代理应在提交前自动运行上述检查并修复失败项；新增/变更代码应补充或更新相应测试。

4) 代码风格与规范

语言级别：<如 TypeScript strict / Python 3.11+ type hints mandatory>

格式化：<prettier/ruff/black 的命令与忽略策略>

命名与结构：

模块/包命名：<约定>

文件组织：<分层/领域/特性目录结构约定>

提交信息：遵循 <Conventional Commits/自定义格式>，示例：feat(ui): support dark mode

兼容性与弃用：

新代码不得引入 <列出禁用 API 或模式>

若移除/替换接口，附带迁移说明与 deprecations

5) 常见任务 Playbooks
5.1 修复单元测试失败

运行 测试/类型检查。

最小改动修复失败点，必要时补测试覆盖问题用例。

运行全量检查，确保通过。

更新变更记录并提交。

5.2 新增小特性

在 <模块/目录> 内按约定创建文件。

补充/更新测试与文档。

本地通过构建、lint、typecheck、测试。

发起变更，遵循 PR 模板。

5.3 依赖升级（安全/补丁级）

仅升级 <允许范围>，变更需最小化。

运行全量测试与构建。

若有破坏性变更，回滚并开 Issue 说明。

6) 工具与接口（Tools/MCP/函数工具）

代理可调用的工具必须声明清楚输入/输出与副作用。

名称	类型	入口	输入模式	输出模式	副作用/注意
<tool_name>	<MCP/函数/HTTP>	<endpoint 或 函数签名>	<JSON Schema/示例>	<JSON Schema/示例>	<写文件/网络请求/需要鉴权等>

调用约束：

不得写入除 <允许的目录> 之外的路径

网络访问仅允许 <白名单域名>

遇到 4xx/5xx 必须重试次数 ≤ <N> 并记录日志

7) 权限、密钥与环境变量

读取方式：<dotenv/系统环境/密钥管理器>

必需变量：<VAR_A>、<VAR_B>（说明作用与格式）

安全要求：禁止将密钥写入仓库、日志与 PR；必要时用占位符模拟。

8) 数据与隐私

输入数据可能包含 <PII/业务敏感信息>。

不得将样本数据上传到外部服务；如需脱敏，使用 <工具/脚本>。

日志中对个人标识字段进行 <掩码策略>。

9) 安全护栏

禁止执行具有破坏性或不可逆操作的命令：<例如 rm -rf、DROP TABLE、强制 push>

涉及迁移或 schema 变更，必须先生成迁移脚本并在本地验证。

任何外部发包/部署动作必须由人类触发。

10) 模型与推理偏好

推荐模型与配置：<model_name, temperature, max_tokens 等>

结构化输出：优先使用 <JSON/TypedDict/Pydantic>，失败时回退为纯文本并重试一次。

上下文策略：优先读取与当前改动文件最近的 AGENTS.md。

11) 多代理协作与交接

任务分流示例：

<triage-agent> 负责路由到 <bugfix-agent> 或 <feature-agent>

交接时携带上下文：问题描述、相关文件清单、失败用例、已尝试步骤

禁止循环交接；最多 <N> 次后回退人工处理。

12) 评估与回归

基线任务清单：<列出典型修复/重构/生成文档等评测任务>

通过标准：<例如：所有修改通过测试且无 lint 违例；性能回归阈值>

评估脚本：

<例如：pnpm eval 或 python scripts/eval.py>

13) 观测与追踪

本地调试日志：<启用方式与日志级别>

Trace/Run 记录：<例如 OpenTelemetry/内部追踪系统 写法>

产物：将运行记录输出到 <.artifacts/>，包含命令、错误、修复摘要。

14) 失败恢复与回滚

若出现以下情况必须回滚：测试红、lint 不通过、依赖破坏性变更、性能超阈。

回滚流程：<脚本或命令>，并创建 <issue 模板> 追踪。

提供最小复现步骤与修复建议。

15) 提交与 PR 规则

提交信息：遵循 <Conventional Commits/自定义>

PR 模板要点：

变更类型与范围

对应 Issue/任务

自测清单：构建/类型/测试/文档

风险与回滚预案

合并策略：<squash/rebase/merge>，保护分支列表：<main/release/*>。

16) Monorepo 说明

使用 <turbo/nx/pants> 进行跨包任务：

<如：pnpm turbo run test --filter <pkg>>


新增包流程与命名约定：<说明>

子包可放置各自的 AGENTS.md，就近覆盖本文件的通用规则。

17) 术语表与联系人

术语：<列出内部缩写与定义>

负责人：<姓名/邮箱/Slack>

紧急通道：<如何联系人工>

附：最小命令速查
# 安装
<install>

# 开发
<dev>

# 全量检查
<lint && typecheck && test>

# 单测聚焦
<your focusing command>


维护说明：本文件为活文档。当规约或脚本更新时，请同步修改此处。